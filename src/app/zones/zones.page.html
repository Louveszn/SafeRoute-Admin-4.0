<div class="page">
  <div class="page-header">
    <div class="title-row">
      <h1>Danger Zones</h1>

      <!-- MULTI-SELECT CATEGORY CHIPS (same behavior as zones) -->
      <div class="category-chips">
        <ion-chip class="cat chip-theft"
                  (click)="toggleCategory('Theft')"
                  [outline]="!isSelected('Theft')"
                  [class.selected]="isSelected('Theft')">
          <ion-label>Theft</ion-label>
        </ion-chip>

        <ion-chip class="cat chip-assault"
                  (click)="toggleCategory('Assault')"
                  [outline]="!isSelected('Assault')"
                  [class.selected]="isSelected('Assault')">
          <ion-label>Assault</ion-label>
        </ion-chip>

        <ion-chip class="cat chip-flood"
                  (click)="toggleCategory('Flood')"
                  [outline]="!isSelected('Flood')"
                  [class.selected]="isSelected('Flood')">
          <ion-label>Flood</ion-label>
        </ion-chip>

        <ion-chip class="cat chip-car"
                  (click)="toggleCategory('Car Accident')"
                  [outline]="!isSelected('Car Accident')"
                  [class.selected]="isSelected('Car Accident')">
          <ion-label>Car Accident</ion-label>
        </ion-chip>

        <ion-chip class="cat chip-blocked"
                  (click)="toggleCategory('Blocked Lane')"
                  [outline]="!isSelected('Blocked Lane')"
                  [class.selected]="isSelected('Blocked Lane')">
          <ion-label>Blocked Lane</ion-label>
        </ion-chip>

                <ion-chip class="cat chip-kid"
                  (click)="toggleCategory('Kidnapping')"
                  [outline]="!isSelected('Kidnapping')"
                  [class.selected]="isSelected('Kidnapping')">
          <ion-label>Kidnapping</ion-label>
        </ion-chip>

        <ion-chip class="cat chip-fire"
                  (click)="toggleCategory('Fire')"
                  [outline]="!isSelected('Fire')"
                  [class.selected]="isSelected('Fire')">
          <ion-label>Fire</ion-label>
        </ion-chip>

        <ion-chip class="cat chip-animal"
                  (click)="toggleCategory('Animal Attack')"
                  [outline]="!isSelected('Animal Attack')"
                  [class.selected]="isSelected('Animal Attack')">
          <ion-label>Animal Attack</ion-label>
        </ion-chip>

        <ion-chip class="cat chip-rob"
                  (click)="toggleCategory('Robbery')"
                  [outline]="!isSelected('Robbery')"
                  [class.selected]="isSelected('Robbery')">
          <ion-label>Robbery</ion-label>
        </ion-chip>
      </div>
    </div>
    
    <div class="right-actions">
      <ion-button class="tap-btn" (click)="toggleTap()">
        {{ tapEnabled ? 'CANCEL TAP' : 'TAP TO REPORT' }}
      </ion-button>

      <div class="legend-card">
        <div class="legend-title">Cluster Danger Level</div>
        <div class="legend-row"><span class="box low"></span> Low</div>
        <div class="legend-row"><span class="box med"></span> Medium</div>
        <div class="legend-row"><span class="box hi"></span> High</div>
      </div>

      <div class="user-pill">
        <ion-icon name="person-circle-outline"></ion-icon>
        <span>Hello, {{ barangay }}</span>
      </div>
    </div>
  </div>

  <div class="map-card">
    <div id="map" class="leaflet-host"></div>
  </div>

  <div class="coord-readout" *ngIf="lastLatLng">
    Selected: <b>{{ lastLatLng.lat.toFixed(6) }}</b>, <b>{{ lastLatLng.lng.toFixed(6) }}</b>
  </div>
</div>

<!-- Report Modal -->
<ion-modal [isOpen]="reportOpen" (didDismiss)="closeReport()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>New Report</ion-title>
        <ion-buttons slot="end"><ion-button (click)="closeReport()">Close</ion-button></ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      <ion-list lines="none">
        <ion-item class="rounded">
          <ion-label position="stacked">Category</ion-label>
          <ion-select [(ngModel)]="form.category" interface="popover" placeholder="Choose category">
            <ion-select-option value="Theft">Theft</ion-select-option>
            <ion-select-option value="Assault">Assault</ion-select-option>
            <ion-select-option value="Flood">Flood</ion-select-option>
            <ion-select-option value="Car Accident">Car Accident</ion-select-option>
            <ion-select-option value="Blocked Lane">Blocked Lane</ion-select-option>
            <ion-select-option value="Kidnapping">Kidnapping</ion-select-option>
            <ion-select-option value="Fire">Fire</ion-select-option>
            <ion-select-option value="Animal Attack">Animal Attack</ion-select-option>
            <ion-select-option value="Robbery">Robbery</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item class="rounded" *ngIf="form.category === 'Others'">
          <ion-label position="stacked">Custom Category</ion-label>
          <ion-input [(ngModel)]="form.customCategory" placeholder="Type category"></ion-input>
        </ion-item>

        <ion-item class="rounded">
          <ion-label position="stacked">Barangay</ion-label>
          <ion-input [value]="barangay" disabled="true"></ion-input>
        </ion-item>

        <ion-item class="rounded">
          <ion-label position="stacked">Landmark</ion-label>
          <ion-input [(ngModel)]="form.landmark" placeholder="Nearest landmark"></ion-input>
        </ion-item>

        <ion-item class="rounded">
          <ion-label position="stacked">Description</ion-label>
          <ion-textarea [(ngModel)]="form.description" auto-grow="true"></ion-textarea>
        </ion-item>

        <!-- Date & Time (automatic, read-only) -->
        <ion-item class="rounded">
          <ion-label position="stacked">Date & Time</ion-label>
          <ion-input [value]="nowPreview" disabled="true"></ion-input>
        </ion-item>

        <ion-item class="rounded">
          <ion-label position="stacked">Coordinates</ion-label>
          <ion-input [value]="coordText" disabled="true"></ion-input>
        </ion-item>
      </ion-list>
    </ion-content>

    <ion-footer>
      <ion-toolbar>
        <ion-buttons slot="end">
          <ion-button fill="clear" (click)="closeReport()">Cancel</ion-button>
          <ion-button strong="true" (click)="saveReport()">Save</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-footer>
  </ng-template>
</ion-modal>